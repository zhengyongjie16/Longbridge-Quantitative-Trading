## 项目概述

- **系统简介**：基于 LongPort OpenAPI / bun / TypeScript 的港股自动化量化交易系统。
- **核心功能**：监控目标资产的技术指标 → 生成交易信号 → 在轮证/ETF上执行双向交易
- **技术栈**：TypeScript (ES2022) + bun + LongPort OpenAPI + pino 日志

## 项目结构示例

```
src/
├── index.ts                        # 主入口（每秒循环）
├── config/                         # 配置模块
├── constants/                      # 全局常量定义
├── types/                          # TypeScript 类型定义
├── main/                           # 主程序架构模块
│   ├── startup/                    # 启动流程（运行门禁/席位恢复与初始寻标）
│   ├── mainProgram/                # 主循环逻辑
│   ├── processMonitor/             # 单标的处理
│   ├── lifecycle/                  # 交易日生命周期管理
│   └── asyncProgram/               # 异步任务处理
├── core/                           # 核心业务逻辑
│   ├── strategy/                   # 信号生成
│   ├── signalProcessor/            # 风险检查与卖出计算
│   ├── riskController/             # 风险检查（持仓/亏损/牛熊证/浮亏监控等）
│   ├── trader/                     # 订单执行与监控
│   ├── orderRecorder/              # 订单记录与查询
│   └── doomsdayProtection/         # 末日保护（收盘前清仓）
├── services/                       # 外部服务
│   ├── quoteClient/                # 行情数据客户端
│   ├── marketMonitor/              # 市场监控（价格/指标变化）
│   ├── monitorContext/             # 监控上下文工厂
│   ├── autoSymbolFinder/           # 自动寻标（筛选牛/熊证候选）
│   ├── autoSymbolManager/          # 席位管理（寻标/换标状态机）
│   ├── liquidationCooldown/        # 保护性清仓后的买入冷却
│   ├── cleanup/                    # 退出清理
│   └── indicators/                 # 技术指标计算（RSI/KDJ/MACD/MFI/EMA/PSY）
└── utils/                          # 工具模块
```

## 代码规范

- 当你需要编写任何TypeScript代码，强制使用typescript-project-specifications skill

## 注释规范

- 注释语言以中文为主，专有名词可保留英文（如 `OrderMonitor`、`RefreshGate`）。
- 新增任意 `.ts` 模块时（除 `types.ts` 、 `utils.ts` 、 `utils/` 和 `types/` 下的文件外），必须添加文件头块注释（`/** ... */`），不限制目录（包括 `src/`、`tests/`、`mock/`等）。
- 文件头注释风格："模块名 + 功能/职责/执行流程"。
- `types.ts` 和 `types/` 下的文件无需文件头块注释，但每个类型定义必须添加独立块注释，内容包含：类型用途（例如**的参数、依赖注入、返回结果等）、数据来源（如适用）、使用范围限制（如仅内部使用）。
- `utils.ts` 和 `utils/` 下的文件无需文件头块注释，但每个工具函数必须添加独立 JSDoc 块注释，内容包含：功能描述（含默认行为说明）、`@param` 逐参说明、`@returns` 返回值说明。
- 关键函数（核心业务流程、状态机迁移、风控检查、生命周期处理、异步队列处理）必须添加函数注释。
- 函数注释应说明"做什么 + 为什么"，并在必要时补充关键参数、返回值和副作用（如缓存刷新、状态变更、对象池释放）。
- 行内注释仅用于解释复杂业务判断或顺序约束（如风控顺序、门禁短路、跨日处理原因），避免对显而易见代码做重复描述。
- 修改业务逻辑时必须同步更新相关注释，禁止注释与实现不一致。
- 测试代码注释保持轻量（言简意赅）：重点说明场景意图、边界条件和业务期望，不要求为每个简单断言写注释。

## 方案规范

- 当需要你给出修改或重构方案时，所有方案必须是系统性且完整性的修改或重构，不允许给出兼容性或补丁性的方案
- 不允许自行给出我提供的需求以外的方案，例如一些兜底方案，这可能导致业务逻辑偏移问题
- 必须确保方案的逻辑正确，必须经过全链路的逻辑验证
- 任何不确定的地方必须同我进行确认

## 行为约束

- 当我没有明确让你修改和重构时你不能进行代码修改，你必须确认我的指令
- 当我没有明确让你编写文档时你不能新建文档，你必须确认我的指令
- 在你执行任务过程中如果有疑问或存在不确定的地方必须询问我的意见，必须与我进行确认
