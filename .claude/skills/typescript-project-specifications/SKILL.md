---
name: typescript-project-specifications
description: 编写简洁、易于维护且遵循严格规范的 TypeScript 代码。在编写、修改或重构 .ts 文件时使用。强制执行核心原则（必须遵守）。适用场景：创建新 TypeScript 文件、重构现有代码、代码审查、修复类型错误、检查代码规范、代码简化。当用户提到"写代码"、"重构"、"修改"、"检查"、"简化"、"创建文件"、"添加功能"时自动使用这个skill。
---

# TypeScript Project Specifications

## 核心原则（必须遵守）

### 基础规范

1. **严格的ts编写**：必须完全遵守[typescript-strict文档](./reference/typescript-strict.md)
2. **文件命名**：使用小写驼峰命名（camelCase），config/下文件除外
3. **不可变数据**：所有类型属性使用 `readonly`，数组使用 `ReadonlyArray`，可以视情况宽容（若存在必须要修改的属性可宽容，过多的只读性会影响性能）

### 架构模式

4. **工厂函数模式**：使用工厂函数而非类来创建对象
5. **非闭包函数提升**：定义在工厂函数内部、但完全没有使用外层变量（闭包）的函数，必须移到模块顶层（outer scope），避免每次调用工厂函数时重复创建，且逻辑更清晰
6. **依赖注入模式**：所有依赖通过参数注入，永远不在内部创建
7. **对象池模式例外**：对象池类型（如 `PoolableSignal`）使用可变属性和 `| null` 标记，这是性能优化的必要例外。使用对象池对象后**必须**及时释放，嵌套对象也需要递归释放

### 类型规范

8. **禁止重复类型**：不允许 `type A = B` 形式的类型别名，应直接使用 `B`
9. **禁止等价类型**：不允许 `type Price = number` 形式的基础类型重命名，应直接使用 `number`
10. **类型组织**：类型定义必须放在 `types.ts` 文件中，共享类型应定义在公共的 `types.ts` 文件中（跨文件或跨模块的公共位置的 types 文件）

### 代码组织

12. **工具函数组织**：工具函数（纯工具）定义必须放在 `utils.ts` 文件中，公共工具应定义在公共的 `utils.ts` 文件中（跨文件或跨模块的公共位置的 utils 文件），不要定义重复的工具函数，注意纯函数不应使用 create 开头命名
13. **常量组织**：常量定义统一放在 `/src/constants` 文件下，不要定义重复的常量

### 代码风格

14. **禁止 re-export**：所有文件和代码均不允许重复导入再导出（禁止 re-export 模式）。类型、函数、常量、类等任何符号均应**直接从定义处（源模块）引用**，不得在中间文件中“转手”导出。例如：若需使用某类型或函数，应在使用处直接 `import ... from '.../源模块'`，而非 `import ... from '.../bar'` 且 bar 仅做 `export { ... } from '.../源模块'`
15. **禁止嵌套三元表达式**：不允许使用嵌套的三元运算符（三元内部包含三元），应使用 `if-else`、`switch`、`Map` 映射或提取为独立函数
16. **函数参数限制**：函数参数不允许超过 7 个，超过时必须使用对象参数（解构入参）
17. **禁止否定条件前置**：在 `if-else` 语句中，`if` 条件不应使用否定表达式（如 `!isValid`），应将肯定条件放在 `if` 分支；仅有 `if` 无 `else` 的 guard clause 除外

### 代码质量

18. **无兼容性代码**：不要编写兼容式、补丁式和临时性的代码，必须编写完整的系统性代码
19. **无临时或多余的注释**：不要编写临时性和多余的注释，例如此次代码更新的步骤或更新的内容（与代码无关）
20. **清除无用/临时代码**：不要保留无用/无效的代码或已弃用的代码，不要保留临时的测试文件

### 流程要求

21. **完成检查**：编写完成后**必须**运行 `npm run lint` 和 `npm run type-check` 并修复所有问题

## 类型和工具函数定义位置（示例）

```
src/
├── core/                   # 核心业务模块（示例）
│   ├── types.ts            # core模块中的公共类型
│   ├── utils.ts            # core模块中的公共函数
│   └── risk/               # 风险检查模块（示例）
│        ├── index.ts       # 风险检查模块逻辑
│        ├── types.ts       # 风险检查模块独享类型
│        └── utils.ts       # 风险检查模块独享工具函数
├── utils/                  # 公共工具模块（包含主index的公共函数）
└── types/                  # 公共类型模块（包含主index的公共类型）
```

## 示例文档

以下示例展示了核心原则的正确和错误写法：

- [工厂函数与依赖注入](./examples/factory-and-di.md) - 工厂函数模式、非闭包函数提升、依赖注入的正反对比
- [对象池模式](./examples/object-pool.md) - 对象池的实现、嵌套释放、异常安全处理
- [代码风格规则](./examples/code-style-rules.md) - 类型定义、三元表达式、参数限制、条件语句的正反对比

## 验证检查清单

完成代码后必须逐项检查：

- [ ] 遵守 [typescript-strict文档](./reference/typescript-strict.md)，文件命名 camelCase
- [ ] 使用工厂函数 + 依赖注入，非闭包函数已提升到模块顶层
- [ ] 类型属性 `readonly`，数组 `ReadonlyArray`（对象池例外）
- [ ] 无重复类型（`type A = B`）、无等价类型（`type A = number`）、无 re-export（类型/函数/常量等均从源模块直接引用）
- [ ] 类型在 `types.ts`，工具函数在 `utils.ts`，常量在 `/src/constants`
- [ ] 无嵌套三元、函数参数 ≤ 7 个、`if-else` 中 `if` 非否定条件
- [ ] 无兼容/临时代码、无多余注释、无无用代码
- [ ] 已运行 `npm run lint` 和 `npm run type-check` 并修复所有问题
