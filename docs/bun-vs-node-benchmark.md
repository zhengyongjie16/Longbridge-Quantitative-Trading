# Bun 1.3.8 vs Node.js 25 性能对比报告

> 测试日期: 2026-02-18（技术指标部分更新）
> 测试环境: Windows
> Node.js 版本: v25.4.0
> Bun 版本: 1.3.8
> **重要更新**: 技术指标计算测试已更新为使用项目当前自研指标库（已弃用 technicalindicators）

## 目录

- [测试概述](#测试概述)
- [测试结果汇总](#测试结果汇总)
- [详细测试数据](#详细测试数据)
  - [启动时间](#1-启动时间)
  - [基础计算性能](#2-基础计算性能)
  - [文件 I/O 性能](#3-文件-io-性能)
  - [JSON 解析性能](#4-json-解析性能)
  - [技术指标计算](#5-技术指标计算)
  - [异步并发性能](#6-异步并发性能)
  - [内存使用](#7-内存使用)
  - [technicalindicators 库（历史基线）](#8-technicalindicators-库历史基线)
  - [项目业务逻辑测试](#9-项目业务逻辑测试)
- [综合分析](#综合分析)
- [迁移建议](#迁移建议)

---

## 测试概述

本报告针对港股量化交易系统从 Node.js 迁移到 Bun 的可行性进行全面的性能对比分析。测试覆盖以下领域：

- 运行时启动时间
- 基础计算性能（循环、数组、递归、数学运算）
- 文件 I/O 性能（同步/异步读写）
- JSON 序列化与解析
- 技术指标计算（RSI、MACD、KDJ、EMA）
- 异步并发性能（Promise、事件循环）
- 内存使用与 GC 性能
- 历史基线库 `technicalindicators` 性能（用于迁移前后对照）

---

## 测试结果汇总

### 性能对比总览

| 测试领域                           | 胜出方  | 性能差异      |
| ---------------------------------- | ------- | ------------- |
| 启动时间                           | Node.js | 快 15%        |
| 基础数学运算                       | **Bun** | **快 7.6x**   |
| 数组操作                           | **Bun** | **快 6.6x**   |
| 文件 I/O (异步)                    | **Bun** | **快 2-3x**   |
| JSON 序列化                        | Node.js | 快 2.3x       |
| JSON 解析                          | 持平    | -             |
| technicalindicators 库（历史基线） | **Bun** | **快 1.2-2x** |
| 异步并发 (带计算)                  | **Bun** | **快 2.3x**   |
| 内存占用                           | Node.js | 低 2.5x       |

---

## 详细测试数据

### 1. 启动时间

冷启动时间测试（5次平均）：

| 运行时         | 平均启动时间 |
| -------------- | ------------ |
| Node.js 25.4.0 | ~55ms        |
| Bun 1.3.8      | ~63ms        |

**结论**: Node.js 启动速度快约 15%

---

### 2. 基础计算性能

| 测试项                         | Node.js   | Bun      | 倍数     | 胜出    |
| ------------------------------ | --------- | -------- | -------- | ------- |
| 简单循环 (1亿次)               | 65.17ms   | 58.68ms  | 1.1x     | Bun     |
| 数组 map/filter/reduce (100万) | 51.61ms   | 7.79ms   | **6.6x** | **Bun** |
| 对象创建与访问 (100万)         | 61.25ms   | 54.83ms  | 1.1x     | Bun     |
| 递归斐波那契 (n=35)            | 78.05ms   | 47.50ms  | **1.6x** | **Bun** |
| 数学运算 (1000万次)            | 1148.78ms | 151.18ms | **7.6x** | **Bun** |

**结论**: Bun 在基础计算方面全面领先，特别是数学运算快 7.6 倍

---

### 3. 文件 I/O 性能

测试数据大小：小文件 13KB、中文件 1MB、大文件 10MB

| 测试项              | Node.js | Bun     | 倍数     | 胜出    |
| ------------------- | ------- | ------- | -------- | ------- |
| 同步写入小文件 x100 | 22.85ms | 22.57ms | 1.0x     | 持平    |
| 同步读取小文件 x100 | 3.63ms  | 2.97ms  | 1.2x     | Bun     |
| 异步写入中文件 x10  | 14.08ms | 4.85ms  | **2.9x** | **Bun** |
| 异步读取中文件 x10  | 5.36ms  | 2.35ms  | **2.3x** | **Bun** |
| 异步写入大文件 x3   | 35.09ms | 11.22ms | **3.1x** | **Bun** |
| 异步读取大文件 x3   | 13.82ms | 7.92ms  | **1.7x** | **Bun** |

**结论**: Bun 在异步文件 I/O 方面优势明显，快 2-3 倍

---

### 4. JSON 解析性能

测试数据：模拟 K 线数据（小型 16KB、中型 1.6MB、大型 15.7MB）

| 测试项                    | Node.js  | Bun      | 倍数 | 胜出        |
| ------------------------- | -------- | -------- | ---- | ----------- |
| 小型序列化 (100条) x1000  | 19.59ms  | 44.96ms  | 2.3x | **Node.js** |
| 小型解析 x1000            | 36.03ms  | 36.50ms  | 1.0x | 持平        |
| 中型序列化 (10000条) x100 | 231.13ms | 281.64ms | 1.2x | Node.js     |
| 中型解析 x100             | 358.37ms | 354.76ms | 1.0x | 持平        |
| 大型序列化 (100000条) x10 | 284.19ms | 299.74ms | 1.1x | Node.js     |
| 大型解析 x10              | 388.32ms | 378.13ms | 1.0x | 持平        |

**结论**: Node.js 在 JSON 序列化方面更快，解析性能两者相当

---

### 5. 技术指标计算（当前库实现）

使用项目当前自研指标计算库的性能测试（已弃用 technicalindicators，改用自行计算方式）：

| 测试项                  | Node.js  | Bun      | 倍数      | 胜出    |
| ----------------------- | -------- | -------- | --------- | ------- |
| RSI (500条) x1000       | 61.71ms  | 48.83ms  | **1.26x** | **Bun** |
| RSI (10000条) x100      | 123.61ms | 99.84ms  | **1.24x** | **Bun** |
| MACD (500条) x1000      | 21.88ms  | 22.22ms  | 0.98x     | Node.js |
| MACD (10000条) x100     | 38.11ms  | 46.75ms  | 0.82x     | Node.js |
| KDJ (500条) x1000       | 26.28ms  | 42.79ms  | 0.61x     | Node.js |
| KDJ (10000条) x100      | 41.71ms  | 60.90ms  | 0.68x     | Node.js |
| EMA (500条) x1000       | 12.10ms  | 9.96ms   | **1.21x** | **Bun** |
| EMA (10000条) x500      | 83.92ms  | 79.97ms  | 1.05x     | **Bun** |
| MFI (500条) x1000       | 60.95ms  | 70.02ms  | 0.87x     | Node.js |
| MFI (10000条) x100      | 112.46ms | 120.70ms | 0.93x     | Node.js |
| PSY (500条) x1000       | 0.13ms   | 0.16ms   | 0.81x     | Node.js |
| PSY (10000条) x100      | 0.01ms   | 0.01ms   | 0.66x     | Node.js |
| 组合指标 (500条) x500   | 120.78ms | 115.97ms | 1.04x     | **Bun** |
| 组合指标 (10000条) x100 | 432.31ms | 447.05ms | 0.97x     | Node.js |

**测试说明**:

- 测试日期: 2026-02-18
- 测试环境: Windows
- Node.js 版本: v25.4.0
- Bun 版本: 1.3.8
- 使用项目当前自研指标计算库（src/services/indicators/）

**结论**:

- Bun 在 RSI 和 EMA 计算方面表现更好，快约 1.2-1.26 倍
- Node.js 在 MACD、KDJ、MFI、PSY 方面表现更好
- 组合指标（buildIndicatorSnapshot）性能接近，Bun 在小数据集略快，Node.js 在大数据集略快
- 总体而言，两者性能各有优劣，Bun 在部分指标上有优势，但 Node.js 在更多指标上表现更好

---

### 6. 异步并发性能

| 测试项                     | Node.js | Bun    | 倍数     | 胜出    |
| -------------------------- | ------- | ------ | -------- | ------- |
| Promise.all (1000个)       | 0.08ms  | 0.10ms | 1.2x     | Node.js |
| Promise.all 带计算 (100个) | 12.99ms | 5.62ms | **2.3x** | **Bun** |
| 串行 async/await (100次)   | 0.02ms  | 0.02ms | 1.0x     | 持平    |
| Promise 链 (1000层)        | 0.05ms  | 0.11ms | 2.2x     | Node.js |
| queueMicrotask (10000次)   | 0.38ms  | 0.70ms | 1.8x     | Node.js |
| 创建 10 万个 Promise       | 12.77ms | 9.50ms | 1.3x     | Bun     |

**结论**: 异步性能各有优劣，Bun 在带计算的并发任务中更快

---

### 7. 内存使用

#### 内存操作性能

| 测试项                | Node.js  | Bun      | 倍数     | 胜出    |
| --------------------- | -------- | -------- | -------- | ------- |
| 创建 100 万个小对象   | 16.17ms  | 10.56ms  | 1.5x     | Bun     |
| 创建 100 万个字符串   | 80.60ms  | 36.63ms  | **2.2x** | **Bun** |
| 大数组操作 (1000万)   | 167.39ms | 22.63ms  | **7.4x** | **Bun** |
| 对象池操作 (100万次)  | 3.07ms   | 2.22ms   | 1.4x     | Bun     |
| Float64Array (1000万) | 29.75ms  | 37.10ms  | 1.2x     | Node.js |
| Map 操作 (100万次)    | 599.17ms | 646.73ms | 1.1x     | Node.js |

#### 内存占用对比

| 指标     | Node.js | Bun      |
| -------- | ------- | -------- |
| 初始 RSS | 45 MB   | 116 MB   |
| 最终 RSS | 574 MB  | 1443 MB  |
| RSS 增长 | +529 MB | +1327 MB |

**结论**: Bun 内存操作速度更快，但内存占用是 Node.js 的 2.5 倍

---

### 8. technicalindicators 库（历史基线）

使用迁移前依赖 `technicalindicators` 的历史数据进行测试：

| 测试项             | Node.js  | Bun      | 倍数      | 胜出    |
| ------------------ | -------- | -------- | --------- | ------- |
| RSI (500条) x1000  | 98.62ms  | 73.02ms  | **1.35x** | **Bun** |
| RSI (2000条) x500  | 184.52ms | 152.07ms | **1.21x** | **Bun** |
| MACD (500条) x1000 | 68.80ms  | 35.19ms  | **1.95x** | **Bun** |
| MACD (2000条) x500 | 125.05ms | 66.04ms  | **1.89x** | **Bun** |
| EMA (5000条) x1000 | 132.49ms | 84.55ms  | **1.57x** | **Bun** |

**结论**: 历史基线显示，在 `technicalindicators` 上 Bun 比 Node.js 快 1.2-2 倍。

---

### 9. 项目业务逻辑测试

基于项目实际代码逻辑进行的性能测试，模拟真实运行场景：

#### 基础操作性能

| 测试项           | Node.js  | Bun     | 倍数      | 胜出    |
| ---------------- | -------- | ------- | --------- | ------- |
| 快照克隆 x10000  | 0.34ms   | 1.26ms  | 3.7x      | Node.js |
| 快照克隆 x100000 | 2.97ms   | 4.16ms  | 1.4x      | Node.js |
| 配置解析 x10000  | 44.3ms   | 47.49ms | 1.07x     | Node.js |
| 配置解析 x50000  | 224.68ms | 237.3ms | 1.06x     | Node.js |
| 条件评估 x10000  | 8.93ms   | 8.72ms  | 1.02x     | 持平    |
| 条件评估 x100000 | 89.41ms  | 79ms    | **1.13x** | **Bun** |

#### 数据结构操作

| 测试项                       | Node.js | Bun     | 倍数     | 胜出    |
| ---------------------------- | ------- | ------- | -------- | ------- |
| 环形缓冲区 push x10000       | 1.27ms  | 0.45ms  | **2.8x** | **Bun** |
| 环形缓冲区 getEntries x10000 | 0.31ms  | 0.36ms  | 1.16x    | Node.js |
| 环形缓冲区 getLatest x100000 | 0.14ms  | 0.11ms  | 1.27x    | Bun     |
| 对象池操作 x10000            | 0.49ms  | 0.48ms  | 1.02x    | 持平    |
| 对象池操作 x100000           | 4.75ms  | 4.61ms  | 1.03x    | 持平    |
| Map get/set x100000          | 6.42ms  | 5.22ms  | 1.23x    | Bun     |
| Set has/add x100000          | 2.4ms   | 15.81ms | 6.6x     | Node.js |

#### 综合主循环模拟（最重要）

| 测试项              | Node.js  | Bun      | 倍数      | 胜出    |
| ------------------- | -------- | -------- | --------- | ------- |
| 单次主循环迭代 x100 | 48.22ms  | 33.11ms  | **1.46x** | **Bun** |
| 单次主循环迭代 x500 | 228.09ms | 147.36ms | **1.55x** | **Bun** |
| 并发处理10标的 x50  | 238.35ms | 168.17ms | **1.42x** | **Bun** |
| 并发处理10标的 x100 | 496.5ms  | 326.25ms | **1.52x** | **Bun** |

**结论**: 在模拟项目实际主循环运行时，Bun 比 Node.js 快 **1.4-1.55x**

---

## 综合分析

### Bun 优势领域

| 领域                               | 性能提升      |
| ---------------------------------- | ------------- |
| **项目主循环模拟**                 | **1.4-1.55x** |
| technicalindicators 库（历史基线） | 1.2-2.0x      |
| 基础数学运算                       | 7.6x          |
| 数组操作                           | 6.6x          |
| 异步文件 I/O                       | 2-3x          |
| 大数组内存操作                     | 7.4x          |
| 带计算的并发任务                   | 2.3x          |
| 环形缓冲区 push                    | 2.8x          |

### Node.js 优势领域

| 领域         | 性能提升  |
| ------------ | --------- |
| Set 操作     | 6.6x      |
| 快照克隆     | 1.4-3.7x  |
| JSON 序列化  | 2.3x      |
| 启动时间     | 1.15x     |
| 内存占用     | 2.5x 更低 |
| 事件循环调度 | 1.8x      |

---

## 迁移建议

### 结论：建议迁移到 Bun

基于测试结果，**建议迁移到 Bun**，主要理由：

1. **项目主循环性能提升**: 模拟实际业务逻辑时，Bun 比 Node.js 快 **1.4-1.55x**
2. **核心业务性能提升（历史基线）**: 使用 `technicalindicators` 库时，Bun 比 Node.js 快 1.2-2 倍
3. **整体计算性能优势**: Bun 在数学运算、数组操作方面有显著优势
4. **文件 I/O 更快**: 日志写入等操作会更快

### 迁移注意事项

1. **内存监控**: Bun 内存占用较高，建议设置合理的内存限制
2. **依赖兼容性测试**: 确保 `longport` SDK 和 `pino` 日志库正常工作
3. **保留回退方案**: 保持 Node.js 配置作为备用
4. **渐进式迁移**: 先在测试环境验证，再部署到生产环境

### 迁移步骤建议

```bash
# 1. 安装 Bun
curl -fsSL https://bun.sh/install | bash

# 2. 验证依赖兼容性
bun install

# 3. 运行测试
bun run test

# 4. 启动应用
bun run src/index.ts
```

---

## 附录：测试文件

所有测试文件位于 `benchmark/` 目录：

| 文件                        | 说明                       |
| --------------------------- | -------------------------- |
| `01-startup.js`             | 启动时间测试               |
| `02-basic-compute.js`       | 基础计算性能测试           |
| `03-file-io.js`             | 文件 I/O 性能测试          |
| `04-json.js`                | JSON 解析性能测试          |
| `05-indicators.js`          | 技术指标计算测试           |
| `06-async.js`               | 异步并发性能测试           |
| `07-memory.js`              | 内存使用测试               |
| `08-technicalindicators.js` | technicalindicators 库测试 |
| `09-combined-indicators.js` | 组合指标测试               |
| `10-project-logic.js`       | 项目业务逻辑测试           |
| `utils.js`                  | 测试工具函数               |

运行单个测试：

```bash
# Node.js
node benchmark/02-basic-compute.js

# Bun
bun benchmark/02-basic-compute.js
```
